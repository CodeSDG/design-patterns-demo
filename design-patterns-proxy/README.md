## 代理模式

代理模式是一种结构型设计模式，它提供了一个代理对象来控制对其他对象（称为真实主题或目标对象）的访问。代理对象在客户端和目标对象之间起到中介作用，可以用来延缓初始化、控制访问、添加权限校验、记录操作日志、添加额外功能等，而不需要修改目标对象的代码。

## 关键角色

1. **Subject**（抽象主题）：定义了真实主题和代理主题的共同接口，这样一来在客户端可以用同一种方式对待真实主题和代理主题。
2. **RealSubject**（真实主题）：实现了Subject接口，定义了真正的操作，是我们真正要使用的目标对象。
3. **Proxy**（代理）：也实现了Subject接口，持有一个对RealSubject的引用，在其方法中调用真实主题的相应方法，可能在调用前后增加额外的操作。

## 优点

* 增加灵活性：可以在不修改目标对象的前提下，通过代理添加额外的功能。
* 控制访问：可以控制对目标对象的直接访问，例如进行权限验证。
* 延迟初始化：代理可以延迟创建目标对象，直到真正需要的时候。
* 增强功能：可以在调用前后加入日志、监控、事务处理等附加操作。

## 应用场景

代理模式广泛应用于软件开发中，特别是在需要控制访问、增加功能、减少耦合或提高系统灵活性的场景。以下是一些具体的应用场景：

1. 远程代理（Remote Proxy）:
   > 在分布式系统中，代理对象可以代表一个远程的服务或对象，隐藏网络通信的复杂性。例如，RMI（远程方法调用）中的Stub就是一种远程代理，它封装了远程对象的网络通信逻辑，使得客户端像调用本地对象一样调用远程服务。
2. 虚拟代理（Virtual Proxy）:
   > 当创建一个对象的开销较大时（如加载大型图像、初始化复杂对象等），可以先创建一个轻量级的代理对象，仅在真正需要时才创建真实对象。例如，网页上的图片懒加载，先显示一个占位符，直到图片滚动到可视区域时才真正加载图片。
3. 缓存代理（Cache Proxy）:
   > 代理可以缓存目标对象的计算结果或数据，对于重复的请求，直接从缓存中返回结果，避免重复计算或访问资源。例如，数据库查询结果的缓存，或者频繁读取的文件内容缓存。
4. 保护代理（Protection Proxy）:
   > 控制对敏感对象的访问，实现权限验证。例如，系统中的用户访问控制，代理对象会检查用户是否有权限访问某个资源，只有通过验证的请求才会被转发到真实对象。
5. 延迟初始化代理（Lazy Initialization Proxy）:
   > 用于延迟初始化对象，直到第一次真正需要使用时才创建。这对于节省资源、提升性能特别有用，尤其是在处理大量对象或资源有限的环境中。
6. 日志记录与监控代理:
   > 在方法调用前后自动添加日志记录或性能监控代码，而无需修改原有代码。使用动态代理可以轻松实现这一功能。
7. 事务管理代理:
   > 在面向服务的架构中，事务代理可以管理服务调用的事务边界，确保一系列操作要么全部成功，要么全部失败。
8. 智能引用代理:
   > 在Java等语言中，代理可以用来实现智能引用，比如弱引用、软引用等，用于内存管理，帮助垃圾回收器确定何时回收对象。
9. RPC（远程过程调用）框架:
   > 在分布式系统中，RPC框架通常使用代理模式来封装远程服务调用的细节，使远程服务看起来像本地调用一样。

通过以上应用场景可以看出，代理模式通过引入间接层，有效地解耦了系统组件，提高了系统的灵活性和可扩展性。

---

## 示例代码
参考：com.codesdg.design.proxy包下的案例

---
## 动态代理

动态代理是指在运行时根据需要创建一个代理对象，而不是在编译时定义。动态代理通过实现InvocationHandler接口来创建代理对象，在调用代理对象的方法时，会调用InvocationHandler的invoke方法，从而实现对目标对象的代理。
动态代理的实现原理是使用反射机制，通过反射获取目标对象的方法信息，然后根据方法信息创建代理对象。动态代理的实现需要实现InvocationHandler接口，并在invoke方法中实现代理逻辑。

###示例代码：
##### 案例：日志记录与性能监控

##### 场景描述
> 假设我们有一个应用程序，其中包含多个业务逻辑类，我们希望在不修改这些类代码的情况下，为所有方法调用自动添加日志记录和性能监控功能。这种情况下，使用Java的动态代理是一个理想的选择

##### 技术要点
1. **java.lang.reflect.Proxy**: 用于创建动态代理类和实例的类。
2. **java.lang.reflect.InvocationHandler**: 代理实例的调用处理程序接口，自定义的代理逻辑应实现此接口。

##### 实现步骤
参考：com.codesdg.design.dynamic包下的案例